/dts-v1/;
/plugin/;

#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/pinctrl/rockchip.h>
#include <dt-bindings/display/drm_mipi_dsi.h>
#include <dt-bindings/interrupt-controller/irq.h>

/ {
	fragment@0 {
		target = <&dsi0>;
		__overlay__ {
			status = "okay";
			//rockchip,lane-rate = <1000>;
			dsi0_panel: panel@0 {
				status = "okay";
				compatible = "simple-panel-dsi";
				reg = <0>;
				power-supply = <&vcc3v3_lcd_n>;
				backlight = <&backlight>;
				reset-delay-ms = <10>;
				enable-delay-ms = <35>;
				prepare-delay-ms = <6>;
				unprepare-delay-ms = <0>;
				disable-delay-ms = <20>;
				dsi,flags = <(MIPI_DSI_MODE_VIDEO | MIPI_DSI_MODE_VIDEO_BURST | MIPI_DSI_MODE_LPM | MIPI_DSI_MODE_EOT_PACKET)>;
				dsi,format = <MIPI_DSI_FMT_RGB888>;
				dsi,lanes  = <4>;
				dsi,channel = <0>;
				size,width = <120>;
				size,height = <170>;

                panel-init-sequence = [
                    29 02 06 3C 01 09 00 07 00                      
                    29 02 06 14 01 06 00 00 00                      
                    29 02 06 64 01 0B 00 00 00                      
                    29 02 06 68 01 0B 00 00 00                      
                    29 02 06 6C 01 0B 00 00 00                      
                    29 02 06 70 01 0B 00 00 00                      
                    29 02 06 34 01 1F 00 00 00                      
                    29 02 06 10 02 1F 00 00 00                      
                    29 02 06 04 01 01 00 00 00                      
                    29 02 06 04 02 01 00 00 00                      
                    29 02 06 50 04 20 01 F0 03                      
                    29 02 06 54 04 19 00 5A 00                       //5A
                    29 02 06 58 04 20 03 24 00                      
                    29 02 06 5C 04 0A 00 19 00                      
                    29 02 06 60 04 00 05 0A 00                      
                    29 02 06 64 04 01 00 00 00                      
                    29 02 06 A0 04 06 80 44 00
                    29 02 06 A0 04 06 80 04 00
                    29 02 06 04 05 04 00 00 00                      
#if 1   /* three channel */
                    29 02 06 80 04 02 03 04 05     /* three channel */
                    29 02 06 84 04 06 07 07 0A                      
                    29 02 06 88 04 0B 0C 0E 0F                      
                    29 02 06 8C 04 0D 0E 0F 12                      
                    29 02 06 90 04 16 17 13 14                      
                    29 02 06 94 04 15 16 17 1B                      
                    29 02 06 98 04 18 19 1A 06                      
#else   /* four channel */
                    29 02 06 80 04 00 01 02 03     /* four channel */
                    29 02 06 84 04 04 07 05 08
                    29 02 06 88 04 09 0A 0E 0F
                    29 02 06 8C 04 0B 0C 0D 10
                    29 02 06 90 04 16 17 11 12
                    29 02 06 94 04 13 14 15 1B
                    29 02 06 98 04 18 19 1A 06
#endif
                    /*
                    29 02 06 80 04 1A 1A 1A 1A                                          
                    29 02 06 84 04 1A 19 1A 1A                                           
                    29 02 06 88 04 18 18 19 19                                             
                    29 02 06 8C 04 18 18 18 18                                             
                    29 02 06 90 04 19 19 18 12                                             
                    29 02 06 94 04 13 14 15 19                                             
                    29 02 06 98 04 18 19 1A 19
                    */
                    29 02 06 9C 04 31 04 00 00
                ];

				panel-exit-sequence = [
					05 05 01 28
					05 78 01 10
				];

				ports {
					#address-cells = <1>;
					#size-cells = <0>;

					port@0 {
						reg = <0>;
						panel_in_dsi: endpoint {
							remote-endpoint = <&dsi_out_panel>;
						};
					};
				};
			};

			ports {
				#address-cells = <1>;
				#size-cells = <0>;

				port@1 {
					reg = <1>;
					dsi_out_panel: endpoint {
						remote-endpoint = <&panel_in_dsi>;
					};
				};
			};
		};
	};

	fragment@1 {
		target = <&i2c4>;
		__overlay__ {
			status = "okay";
			pinctrl-0 = <&i2c4m3_xfer>;

			ft5x06@38 {
				status = "okay";
				compatible = "edt,edt-ft5406";
				reg = <0x38>;
				touch-gpio = <&gpio3 RK_PD2 IRQ_TYPE_EDGE_RISING>;
				interrupt-parent = <&gpio3>;
				interrupts = <RK_PD3 IRQ_TYPE_LEVEL_LOW>;
				reset-gpios = <&gpio3 RK_PD3 GPIO_ACTIVE_LOW>;
				touchscreen-size-x = <800>;
				touchscreen-size-y = <1280>;
			};
		};
	};
};