/dts-v1/;
/plugin/;

#include <dt-bindings/gpio/gpio.h>
#include <dt-bindings/pinctrl/rockchip.h>
#include <dt-bindings/display/drm_mipi_dsi.h>
#include <dt-bindings/interrupt-controller/irq.h>

/ {
    fragment@0 {
        target = <&route_dsi1>;

        __overlay__ {
            status = "okay";
            connect = <&vp3_out_dsi1>;
        };
    };

    fragment@1 {
        target = <&dsi1_in_vp3>;

        __overlay__ {
            status = "okay";
        };
    };

    fragment@2 {
        target = <&mipi_dcphy1>;

        __overlay__ {
            status = "okay";
        };
    };

    fragment@3 {
        target = <&dsi1>;

        __overlay__ {
            status = "okay";

            dsi1_panel: panel@0 {
                status = "okay";
                compatible = "simple-panel-dsi";
                reg = <0>;
                power-supply = <&vcc3v3_lcd_n>;
                backlight = <&backlight>;
                reset-delay-ms = <10>;
                enable-delay-ms = <35>;
                prepare-delay-ms = <6>;
                unprepare-delay-ms = <0>;
                disable-delay-ms = <20>;
                dsi,flags = <(MIPI_DSI_MODE_VIDEO | MIPI_DSI_MODE_VIDEO_BURST | MIPI_DSI_MODE_LPM | MIPI_DSI_MODE_EOT_PACKET)>;
                dsi,format = <MIPI_DSI_FMT_RGB888>;
                dsi,lanes  = <4>;
                dsi,channel = <0>;
                size,width = <235>;
                size,height = <143>;

                panel-init-sequence = [
                                        29 02 06 3C 01 09 00 07 00                      
                                        29 02 06 14 01 06 00 00 00                      
                                        29 02 06 64 01 0B 00 00 00                      
                                        29 02 06 68 01 0B 00 00 00                      
                                        29 02 06 6C 01 0B 00 00 00                      
                                        29 02 06 70 01 0B 00 00 00                      
                                        29 02 06 34 01 1F 00 00 00                      
                                        29 02 06 10 02 1F 00 00 00                      
                                        29 02 06 04 01 01 00 00 00                      
                                        29 02 06 04 02 01 00 00 00                      

                                        29 02 06 50 04 20 01 F0 03

                                        29 02 06 54 04 10 01 28 00
                                        29 02 06 58 04 00 05 54 00
                                        29 02 06 5C 04 0F 00 14 00
                                        29 02 06 60 04 20 03 14 00
                                        29 02 06 64 04 01 00 00 00                      
                                        29 02 06 A0 04 06 80 44 00
                                        29 02 06 A0 04 06 80 04 00
                                        29 02 06 04 05 04 00 00 00 

                                        29 02 06 80 04 00 01 02 03     /* four channel */
                                        29 02 06 84 04 04 07 05 08
                                        29 02 06 88 04 09 0A 0E 0F
                                        29 02 06 8C 04 0B 0C 0D 10
                                        29 02 06 90 04 16 17 11 12
                                        29 02 06 94 04 13 14 15 1B
                                        29 02 06 98 04 18 19 1A 06

                                        29 02 06 9C 04 31 04 00 00
                ];

                panel-exit-sequence = [
                        05 05 01 28
                        05 78 01 10
                ];

                disp_timings1: display-timings {
                    native-mode = <&dsi1_timing0>;
                    dsi1_timing0: timing0 {
                        clock-frequency = <90000000>;
                        hactive = <1280>;
                        vactive = <800>;
                        hback-porch = <320>;
                        hfront-porch = <1270>;
                        vback-porch = <15>;
                        vfront-porch = <20>;
                        hsync-len = <10>;
                        vsync-len = <20>;
                        hsync-active = <0>;
                        vsync-active = <0>;
                        de-active = <0>;
                        pixelclk-active = <0>;
                    };
                };

                ports {
                    #address-cells = <1>;
                    #size-cells = <0>;

                    port@0 {
                        reg = <0>;
                        panel_in_dsi1: endpoint {
                            remote-endpoint = <&dsi1_out_panel>;
                        };
                    };
                };
            };

            ports {
                #address-cells = <1>;
                #size-cells = <0>;

                port@1 {
                    reg = <1>;
                    dsi1_out_panel: endpoint {
                        remote-endpoint = <&panel_in_dsi1>;
                    };
                };
            };
        };
    };

    fragment@4 {
        target = <&i2c5>;

        __overlay__ {
            status = "okay";
            pinctrl-0 = <&i2c5m0_xfer>;

            gt9xx@5d {
                compatible = "goodix,gt9271";
                reg = <0x5d>;
                interrupt-parent = <&gpio3>;
                interrupts = <RK_PC0 IRQ_TYPE_LEVEL_LOW>;
                reset-gpio = <&gpio3 RK_PC1 GPIO_ACTIVE_LOW>;
                touch-gpio = <&gpio3 RK_PC0 IRQ_TYPE_EDGE_RISING>;
                status = "okay";
                tp-size = <9271>;
                max-x = <1280>;
                max-y = <800>;
                touchscreen-inverted-x;
            };
        };
    };
};
